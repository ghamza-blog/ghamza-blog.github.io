<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Building a CLI tool in Rust - Ghamza Blog</title><link rel=apple-touch-icon sizes=180x180 href=https://static.ghamza.dev/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://static.ghamza.dev/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://static.ghamza.dev/icons/favicon-16x16.png><link rel=manifest href=https://static.ghamza.dev/icons/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=G-M9GYS9Z1XC"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-M9GYS9Z1XC")</script><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Build a CLI tool in Rust"><meta property="og:image" content><meta property="og:title" content="Building a CLI tool in Rust"><meta property="og:description" content="Build a CLI tool in Rust"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.ghamza.dev/posts/rust-cli/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-07T04:20:15+02:00"><meta property="article:modified_time" content="2023-04-07T04:20:15+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a CLI tool in Rust"><meta name=twitter:description content="Build a CLI tool in Rust"><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://blog.ghamza.dev/css/main.c3f13bbfde2908a3d8ce3f7ec8384760955b598ac48f764aa3d037273f657d7d.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://blog.ghamza.dev/css/dark.0de67d2cc3ebdfcbd7ede2119bb89531e7df04d6376ff68f4b781669730e3bc9.css><script src=https://blog.ghamza.devjs/main.js></script></head><body><div class=content><div class=support-ribbon>🕊️🇵🇸 I stand with humanity, I stand with Palestine 🇵🇸🕊️</div><header><div class=main><a href=https://blog.ghamza.dev>Ghamza Blog</a></div><nav><a href=/posts>Archives</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Building a CLI tool in Rust</h1><div class=meta>Posted on Apr 7, 2023</div></div><section class=body><p>Today we&rsquo;re going learn how to write a CLI tool in rust
through creating a dummy implementation of <a href=https://cli.github.com/>Github&rsquo;s CLI tool</a>.</p><p>We&rsquo;re calling it <code>dugh</code> (dummy Github 🤓).</p><h2 id=defining-the-functionality>Defining the functionality</h2><p>Before we start writing code, we should define the functionality of our tool.</p><p>We will start with managing pull requests command and making the tool extensible for other commands.</p><p>An example command would be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo dugh pr create -t <span style=color:#1bc5e0>&#34;title&#34;</span> -d
</span></span></code></pre></div><h2 id=project-setup>Project setup</h2><p>Create a new bin rust project.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo new --bin dugh
</span></span><span style=display:flex><span>cd dugh
</span></span></code></pre></div><p>Add the dependencies that we need.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo add anyhow
</span></span><span style=display:flex><span>cargo add clap -F derive
</span></span></code></pre></div><p>We are using <code>anyhow</code> for error handling and <code>clap</code> for parsing the command line arguments
with the <code>derive</code> feature to fill command line args into a structure.</p><h2 id=basic-setup>Basic setup</h2><p>Setup <code>clap</code> inside <code>main.rs</code> by making a struct and derive <code>Parser</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// main.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>anyhow::Result;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Parser;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Parser)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[command(version, about, long_about = None)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>struct</span> <span style=color:#ceb1ff>Cli</span><span style=color:#a8757b> </span>{}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>main</span>()<span style=color:#a8757b> </span>-&gt; Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>let</span><span style=color:#a8757b> </span>cli<span style=color:#a8757b> </span><span style=color:#ffb8d1>=</span><span style=color:#a8757b> </span>Cli::parse();<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>We are going to create the <code>Execute</code> trait. The purpose of it is to make all subcommands implement it.</p><blockquote><p>Not that important but I like to see things fall under the same rules.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// execute.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>anyhow::Result;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>trait</span><span style=color:#a8757b> </span>Execute<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>execute</span>(<span style=color:#ffb8d1>&amp;</span><span style=color:#80cbc4>self</span>)<span style=color:#a8757b> </span>-&gt; Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span>;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>And surely add <code>mod execute;</code> in <code>main.rs</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// main.rs
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>mod</span> execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>anyhow::Result;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Parser;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Parser)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[command(version, about, long_about = None)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>struct</span> <span style=color:#ceb1ff>Cli</span><span style=color:#a8757b> </span>{}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>main</span>()<span style=color:#a8757b> </span>-&gt; Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>let</span><span style=color:#a8757b> </span>cli<span style=color:#a8757b> </span><span style=color:#ffb8d1>=</span><span style=color:#a8757b> </span>Cli::parse();<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>Now we can create <code>Dugh</code> and have dugh&rsquo;s implement <code>Execute</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// dugh.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>crate</span>::execute::Execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Subcommand;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>enum</span> <span style=color:#ceb1ff>Dugh</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Manage pull requests
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Pr,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>impl</span><span style=color:#a8757b> </span>Execute<span style=color:#a8757b> </span><span style=color:#c2ffdf>for</span><span style=color:#a8757b> </span>Dugh<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>execute</span>(<span style=color:#ffb8d1>&amp;</span><span style=color:#80cbc4>self</span>)<span style=color:#a8757b> </span>-&gt; <span style=color:#ceb1ff>anyhow</span>::Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span><span style=color:#c2ffdf>match</span><span style=color:#a8757b> </span><span style=color:#80cbc4>self</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::Pr<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>Ok(()),<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>Add <code>mod dugh</code>, import it, and add it to the <code>Cli</code> struct.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// main.rs
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>mod</span> dugh;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>mod</span> execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>crate</span>::dugh::Dugh;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>anyhow::Result;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Parser;<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>execute::Execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Parser)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[command(version, about, long_about = None)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>struct</span> <span style=color:#ceb1ff>Cli</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>    </span><span style=color:#b0bec5>#[command(subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>    </span>command: <span style=color:#ceb1ff>Dugh</span>,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>main</span>()<span style=color:#a8757b> </span>-&gt; Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>let</span><span style=color:#a8757b> </span>cli<span style=color:#a8757b> </span><span style=color:#ffb8d1>=</span><span style=color:#a8757b> </span>Cli::parse();<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>    </span>cli.command.execute()<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>Okay, we have a working base now!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo run -- --help
</span></span></code></pre></div><p>It&rsquo;s alive!</p><h2 id=adding-pr-subcommand>Adding PR subcommand</h2><p>Create <code>pr.rs</code>, add <code>mod pr;</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// main.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>mod</span> dugh;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>mod</span> execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b></span><span style=color:#c2ffdf>mod</span> pr;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>crate</span>::dugh::Dugh;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>anyhow::Result;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Parser;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>execute::Execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Parser)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[command(version, about, long_about = None)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>struct</span> <span style=color:#ceb1ff>Cli</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#b0bec5>#[command(subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>command: <span style=color:#ceb1ff>Dugh</span>,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>main</span>()<span style=color:#a8757b> </span>-&gt; Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>let</span><span style=color:#a8757b> </span>cli<span style=color:#a8757b> </span><span style=color:#ffb8d1>=</span><span style=color:#a8757b> </span>Cli::parse();<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>cli.command.execute()<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>and add our <code>pr</code> variants</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// pr.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Subcommand;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>enum</span> <span style=color:#ceb1ff>Pr</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Create a pull request
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Create,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// List pull requests in a repo
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>List,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Show status of relevant pull requests
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Status,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>The <code>///</code> is the command help message that will be displayed when passing <code>--help</code> to the tool.</p><p>Then implement <code>Execute</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// pr.rs
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>crate</span>::execute::Execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Subcommand;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>enum</span> <span style=color:#ceb1ff>Pr</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Create a pull request
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Create,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// List pull requests in a repo
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>List,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Show status of relevant pull requests
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Status,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b></span><span style=color:#c2ffdf>impl</span><span style=color:#a8757b> </span>Execute<span style=color:#a8757b> </span><span style=color:#c2ffdf>for</span><span style=color:#a8757b> </span>Pr<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>execute</span>(<span style=color:#ffb8d1>&amp;</span><span style=color:#80cbc4>self</span>)<span style=color:#a8757b> </span>-&gt; <span style=color:#ceb1ff>anyhow</span>::Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>        </span><span style=color:#c2ffdf>match</span><span style=color:#a8757b> </span><span style=color:#80cbc4>self</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::Create<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>println!(<span style=color:#1bc5e0>&#34;PR Created!&#34;</span>);<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::List<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>println!(<span style=color:#1bc5e0>&#34;List of PRs&#34;</span>);<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::Status<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>println!(<span style=color:#1bc5e0>&#34;PR status&#34;</span>);<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>        </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>    </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>And now we can wire <code>Pr</code> with <code>Dugh</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// dugh.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>crate</span>::{execute::Execute,<span style=color:#a8757b> </span>pr::Pr};<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Subcommand;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>enum</span> <span style=color:#ceb1ff>Dugh</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Manage pull requests
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Pr<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span><span style=color:#b0bec5>#[command(subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span>pr_commands: <span style=color:#ceb1ff>Pr</span>,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>},<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>impl</span><span style=color:#a8757b> </span>Execute<span style=color:#a8757b> </span><span style=color:#c2ffdf>for</span><span style=color:#a8757b> </span>Dugh<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>execute</span>(<span style=color:#ffb8d1>&amp;</span><span style=color:#80cbc4>self</span>)<span style=color:#a8757b> </span>-&gt; <span style=color:#ceb1ff>anyhow</span>::Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span><span style=color:#c2ffdf>match</span><span style=color:#a8757b> </span><span style=color:#80cbc4>self</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::Pr<span style=color:#a8757b> </span>{<span style=color:#a8757b> </span>pr_commands<span style=color:#a8757b> </span>}<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>pr_commands.execute(),<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>Let us see the result!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo run -- pr create
</span></span></code></pre></div><h2 id=adding-arguments-to-a-command>Adding arguments to a command</h2><p>Our <code>Pr</code> variants do not hold any data. Let us change that by making one of the variants a struct</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#b0bec5>// pr.rs
</span></span></span><span style=display:flex><span><span style=color:#b0bec5></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>crate</span>::execute::Execute;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>use</span><span style=color:#a8757b> </span>clap::Subcommand;<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#b0bec5>#[derive(Subcommand)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>enum</span> <span style=color:#ceb1ff>Pr</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Create a pull request
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Create<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>        </span><span style=color:#b0bec5>#[arg(short, long)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>        </span>title: String,<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>        </span><span style=color:#b0bec5>#[arg(short, long)]</span><span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>        </span>draft: <span style=color:#c2ffdf>bool</span>,<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>    </span>},<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// List pull requests in a repo
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>List,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#1bc5e0>/// Show status of relevant pull requests
</span></span></span><span style=display:flex><span><span style=color:#1bc5e0></span><span style=color:#a8757b>    </span>Status,<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span><span style=color:#c2ffdf>impl</span><span style=color:#a8757b> </span>Execute<span style=color:#a8757b> </span><span style=color:#c2ffdf>for</span><span style=color:#a8757b> </span>Pr<span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>execute</span>(<span style=color:#ffb8d1>&amp;</span><span style=color:#80cbc4>self</span>)<span style=color:#a8757b> </span>-&gt; <span style=color:#ceb1ff>anyhow</span>::Result<span style=color:#ffb8d1>&lt;</span>()<span style=color:#ffb8d1>&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span><span style=color:#c2ffdf>match</span><span style=color:#a8757b> </span><span style=color:#80cbc4>self</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::Create<span style=color:#a8757b> </span>{<span style=color:#a8757b> </span>title,<span style=color:#a8757b> </span>draft<span style=color:#a8757b> </span>}<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>println!(<span style=color:#1bc5e0>&#34;PR </span><span style=color:#1bc5e0>{title}</span><span style=color:#1bc5e0> Created! isDraft: </span><span style=color:#1bc5e0>{draft}</span><span style=color:#1bc5e0>&#34;</span>);<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>                </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex;background-color:#555166><span><span style=color:#a8757b>            </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::List<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>                </span>println!(<span style=color:#1bc5e0>&#34;List of PRs&#34;</span>);<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>                </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>            </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>            </span><span style=color:#80cbc4>Self</span>::Status<span style=color:#a8757b> </span><span style=color:#ffb8d1>=&gt;</span><span style=color:#a8757b> </span>{<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>                </span>println!(<span style=color:#1bc5e0>&#34;PR status&#34;</span>);<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>                </span>Ok(())<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>            </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>        </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b>    </span>}<span style=color:#a8757b>
</span></span></span><span style=display:flex><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><p>Run again 👀</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo run -- pr create --title fix/minor-bug-fix -d
</span></span></code></pre></div><h2 id=alias-the-command>Alias the command</h2><p>I like to alias the commands to make them easier to use and smaller.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#b0bec5># .cargo/config.toml</span>
</span></span><span style=display:flex><span>[alias]
</span></span><span style=display:flex><span>dugh = <span style=color:#1bc5e0>&#34;run -rq --bin dugh --&#34;</span>
</span></span></code></pre></div><p>Now we can run it easier</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cargo dugh -d -t <span style=color:#1bc5e0>&#34;Hello World&#34;</span>
</span></span></code></pre></div><blockquote><p>Alias becomes handy when working with a complex project, for example, the current project
I am working on has cargo workspace and two CLI tools.</p></blockquote><h2 id=conclusion>Conclusion</h2><p>We have a working base, but adding more functionality requires adding enum variants on the proper nesting level.</p><p>To support issue management, we add a new variant to <code>Dugh</code> enum. To make a new <code>Pr</code> command, we add a new enum variant for that,
and we write the logic in the branch of that variant.</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/rust>Rust</a></li></ul></nav></div></article><script src=https://giscus.app/client.js data-repo=ghamza-blog/ghamza-blog.github.io data-repo-id=R_kgDOHMIi9w data-category-id=DIC_kwDOHMIi984COoB4 data-mapping=url data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=dark data-lang=en data-loading=lazy crossorigin=anonymous async></script></main><footer><div style=display:flex><a href=https://github.com/Ghamza-Jd title=GitHub><i data-feather=github></i></a>
|<a href=https://www.facebook.com/ghamza.tech title=Facebook><i data-feather=facebook></i></a>
|<a href=https://www.linkedin.com/in/hamza-jadid title=LinkedIn><i data-feather=linkedin></i></a>
|<a href=https://blog.ghamza.dev/index.xml title=rss><i data-feather=rss></i></a>
|</div><div class=footer-info>&nbsp2023  © Hamza Jadid | 
 </div></footer><script>feather.replace()</script></div></body></html>