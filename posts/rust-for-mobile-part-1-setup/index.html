<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Rust for Mobile Development Part 1: Setup - Ghamza Blog</title><link rel=apple-touch-icon sizes=180x180 href=https://static.ghamza.dev/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://static.ghamza.dev/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://static.ghamza.dev/icons/favicon-16x16.png><link rel=manifest href=https://static.ghamza.dev/icons/site.webmanifest><script async src="https://www.googletagmanager.com/gtag/js?id=G-M9GYS9Z1XC"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-M9GYS9Z1XC")</script><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rust for Mobile Development Part 1: Setup"><meta property="og:image" content><meta property="og:title" content="Rust for Mobile Development Part 1: Setup"><meta property="og:description" content="Rust for Mobile Development Part 1: Setup"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.ghamza.dev/posts/rust-for-mobile-part-1-setup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-11T04:20:15+02:00"><meta property="article:modified_time" content="2023-01-11T04:20:15+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust for Mobile Development Part 1: Setup"><meta name=twitter:description content="Rust for Mobile Development Part 1: Setup"><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<link href="https://fonts.googleapis.com/css?family=Fira+Code" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://blog.ghamza.dev/css/main.fdba4ef306acb1dca5545b96e6818114a6bc828051e907b6d87e2472065dfe9d.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://blog.ghamza.dev/css/dark.5fd3ce147f5045c9d9c6e91eebbaa9ffa6b563a220315a3be3a7d8e93c3cf380.css></head><body><div class=content><div class=support-ribbon>🕊️🇵🇸 I stand with humanity, I stand with Palestine 🇵🇸🕊️</div><header><div class=main><a href=https://blog.ghamza.dev>Ghamza Blog</a></div><nav><a href=/posts>Archives</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Rust for Mobile Development Part 1: Setup</h1><div class=meta>Posted on Jan 11, 2023</div></div><section class=body><ul><li><a href=#creating-the-project>Creating the project</a></li><li><a href=#creating-rust-libraries>Creating Rust Libraries</a></li><li><a href=#makefile>Makefile</a></li><li><a href=#install-android-and-ios-targets>Install Android and iOS Targets</a></li><li><a href=#add-minimal-code-inside-core>Add Minimal Code Inside Core</a></li></ul><p>In this series, we&rsquo;ll see how rust works on android and ios by creating an Example library (libexa). We will start with setting up the project.</p><p>To build for android and iOS, you should be on macOS. If you&rsquo;re using windows or linux, you can only build for android, but worth noting that some commands and setups might be different (for example, you might not have <code>make</code>, <code>python</code>, or <code>brew</code> on your machine).</p><p>You can use the development environment you&rsquo;re most comfortable with, but mine is <a href=https://code.visualstudio.com/>VSCode</a> (thinking of moving to <a href=https://helix-editor.com/>Helix</a> 🤓) with these extensions:</p><ul><li><a href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust-analyzer">rust-analyzer</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=bungcip.better-toml">Better TOML</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">CodeLLDB</a></li></ul><p>I also use <a href=https://fig.io/>Fig</a> to get suggestions on the terminal.</p><h2 id=creating-the-project>Creating the project</h2><ol><li><p>We&rsquo;re not going to use <code>cargo new --lib</code> yet; instead, we&rsquo;re going to create an empty directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>mkdir exa-lib
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>cd exa-lib
</span></span></code></pre></div></li><li><p>Then inside of it, we want <code>Cargo.toml</code>, <code>.gitignore</code>, <code>Makefile</code>, and <code>glue/</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>touch Cargo.toml .gitignore Makefile
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>mkdir glue
</span></span></code></pre></div><p><code>Cargo.toml</code> will contain our rust workspace members, and inside <code>Makefile</code> we will put our commands.</p></li><li><p>Add ignore patterns</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>debug/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>target/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>**/*.rs.bk
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>*.pdb
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>.DS_Store
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>.idea/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>.fleet/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>.vscode/
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>main.rs
</span></span></code></pre></div><p>I usually ignore <code>main.rs</code> for libs so I can keep it locally as a playground without pushing my draft code on the repo</p></li><li><p>And finally, initialize git.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>git init
</span></span></code></pre></div></li></ol><h2 id=creating-rust-libraries>Creating Rust Libraries</h2><p>Now we&rsquo;re going to create three rust libraries</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>cargo new --lib exa_core
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>cargo new --lib glue/android
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>cargo new --lib glue/ios
</span></span></code></pre></div><p>Then the rust analyzer will go mad, so let us add them to the workspace inside the <code>Cargo.toml</code> on the root directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-toml data-lang=toml><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>[workspace]
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>members = [
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#1bc5e0>&#34;exa_core&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#1bc5e0>&#34;glue/android&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#1bc5e0>&#34;glue/ios&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>]
</span></span></code></pre></div><h2 id=makefile>Makefile</h2><p>Inside it, we&rsquo;re going to add some commands to make our life easier for the setup and building.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-make data-lang=make><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>ios_targets <span style=color:#ffb8d1>=</span> aarch64-apple-ios x86_64-apple-ios aarch64-apple-ios-sim
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>android_targets <span style=color:#ffb8d1>=</span> armv7-linux-androideabi i686-linux-android aarch64-linux-android x86_64-linux-android
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>lib_name <span style=color:#ffb8d1>=</span> exa
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ceb1ff>android-setup</span><span style=color:#ffb8d1>:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	@for target in <span style=color:#1bc5e0>${</span>android_targets<span style=color:#1bc5e0>}</span> ; <span style=color:#c2ffdf>do</span> <span style=color:#1bc5e0>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#1bc5e0></span>		rustup target add $$target ; <span style=color:#1bc5e0>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#1bc5e0></span>	<span style=color:#c2ffdf>done</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ceb1ff>ios-setup</span><span style=color:#ffb8d1>:</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	cargo install cargo-lipo
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	@for target in <span style=color:#1bc5e0>${</span>ios_targets<span style=color:#1bc5e0>}</span> ; <span style=color:#c2ffdf>do</span> <span style=color:#1bc5e0>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#1bc5e0></span>		rustup target add $$target ; <span style=color:#1bc5e0>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#1bc5e0></span>	<span style=color:#c2ffdf>done</span>
</span></span></code></pre></div><p><em><strong>Note:</strong> Please make sure to use tabs rather than spaces, if we use spaces Makefile will throw this error: <code>Makefile:6: *** missing separator. Stop.</code></em></p><p>In other parts of this series, we will add more commands to this file.</p><h2 id=install-android-and-ios-targets>Install Android and iOS Targets</h2><p>In the previous step, we added commands to setup both Android and iOS, so now let us run them</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>make android-setup
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>make ios-setup
</span></span></code></pre></div><h2 id=add-minimal-code-inside-core>Add Minimal Code Inside Core</h2><p>Inside <code>exa_core/src/lib.rs</code> replace the file&rsquo;s content with a simple greeting function</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#433e56;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#c2ffdf>pub</span><span style=color:#a8757b> </span><span style=color:#c2ffdf>fn</span> <span style=color:#ceb1ff>greet</span>(person: <span style=color:#c2ffdf>&amp;</span><span style=color:#c2ffdf>str</span>)<span style=color:#a8757b> </span>-&gt; String {<span style=color:#a8757b>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#a8757b>    </span>format!(<span style=color:#1bc5e0>&#34;Hello {person}&#34;</span>)<span style=color:#a8757b>
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#a8757b></span>}<span style=color:#a8757b>
</span></span></span></code></pre></div><hr><p>And you&rsquo;ve reached the end of the first part 🦀.</p><p>In the next part, we will start gluing rust code with iOS and create a sample app.</p><p>You can find the code for this article on GitHub <a href=https://github.com/Ghamza-Jd/exa-lib/tree/part-1-setup>Ghamza-Jd/exa-lib</a></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/rust>Rust</a></li><li><a href=/tags/rust-for-mobile>Rust for Mobile</a></li></ul></nav></div></article><script src=https://giscus.app/client.js data-repo=ghamza-blog/ghamza-blog.github.io data-repo-id=R_kgDOHMIi9w data-category-id=DIC_kwDOHMIi984COoB4 data-mapping=url data-reactions-enabled=1 data-emit-metadata=1 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></main><footer><div style=display:flex><a href=https://github.com/Ghamza-Jd title=GitHub><i data-feather=github></i></a>
|<a href=https://www.facebook.com/ghamza.tech title=Facebook><i data-feather=facebook></i></a>
|<a href=https://www.linkedin.com/in/hamza-jadid title=LinkedIn><i data-feather=linkedin></i></a>
|<a href=https://blog.ghamza.dev/index.xml title=rss><i data-feather=rss></i></a>
|</div><div class=footer-info>&nbsp2023  © Hamza Jadid | 
 </div></footer><script>feather.replace()</script></div></body></html>